{% extends "clinic_app/base.html" %}
{% block title %}Doctor Dashboard{% endblock %}
{% block content %}
<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Welcome, Dr. {{ doctor.user.last_name }}</h1>
    <p class="specialization">{{ doctor.specialization }}</p>
  </div>

  <div class="dashboard-stats">
    <div class="stat-card">
      <h3>{{ pending_count }}</h3>
      <p>Pending Appointments</p>
    </div>
    <div class="stat-card">
      <h3>{{ approved_count }}</h3>
      <p>Approved Appointments</p>
    </div>
    <div class="stat-card">
      <h3>{{ completed_count }}</h3>
      <p>Completed Appointments</p>
    </div>
    <div class="stat-card">
      <h3>{{ total_count }}</h3>
      <p>Total Appointments</p>
    </div>
  </div>

  <div class="appointments-section">
    <h2>Your Appointments</h2>

    {% if appointments %}
    <div class="appointments-table-container">
      <table class="appointments-table">
        <thead>
          <tr>
            <th>Patient Name</th>
            <th>Email</th>
            <th>Contact</th>
            <th>Date</th>
            <th>Time</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for appointment in appointments %}
          <tr>
            <td>{{ appointment.patient_name }}</td>
            <td>{{ appointment.patient_email|default:"N/A" }}</td>
            <td>{{ appointment.patient_contact }}</td>
            <td>{{ appointment.appointment_date|date:"M d, Y" }}</td>
            <td>{{ appointment.appointment_time|time:"g:i A" }}</td>
            <td>{{ appointment.reason|truncatewords:10 }}</td>
            <td>
              <span class="status-badge status-{{ appointment.status|lower }}">
                {{ appointment.status }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                {% if appointment.status == "Pending" %}
                <form method="post" action="{% url 'clinic_app:doctor_approve_appointment' appointment.id %}"
                  style="display: inline">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-small btn-success">Approve</button>
                </form>
                {% endif %} {% if appointment.status == "Approved" %}
                <form method="post" action="{% url 'clinic_app:doctor_complete_appointment' appointment.id %}"
                  style="display: inline">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-small btn-primary">Complete</button>
                </form>
                {% endif %}
                <a href="{% url 'clinic_app:doctor_appointment_detail' appointment.id %}"
                  class="btn btn-small btn-info">View</a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="empty-state">
      <p>No appointments found.</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
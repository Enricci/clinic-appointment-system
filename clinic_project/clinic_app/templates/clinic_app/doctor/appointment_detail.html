{% extends "clinic_app/base.html" %}
{% block title %}Appointment Details{% endblock %}

{% block content %}
<div class="appointment-detail-container">
  <div class="detail-header">
    <div class="header-content">
      <a href="{% url 'clinic_app:doctor_dashboard' %}" class="back-button">
        Back to Dashboard
      </a>
      <h1>Appointment Details</h1>
      <span class="status-badge status-{{ appointment.status|lower }}">
        {{ appointment.status }}
      </span>
    </div>
  </div>

  <div class="detail-grid">
    <!-- Patient Information Card -->
    <div class="detail-card">
      <div class="card-header">
        <h2>Patient Information</h2>
      </div>
      <div class="card-content">
        <div class="info-row">
          <span class="info-label">Full Name</span>
          <span class="info-value">{{ appointment.patient_name }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Email</span>
          <span class="info-value">{{ appointment.patient_email|default:"Not provided" }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Contact Number</span>
          <span class="info-value">{{ appointment.patient_contact }}</span>
        </div>
      </div>
    </div>

    <!-- Appointment Information Card -->
    <div class="detail-card">
      <div class="card-header">
        <h2>Appointment Information</h2>
      </div>
      <div class="card-content">
        <div class="info-row">
          <span class="info-label">Date</span>
          <span class="info-value">{{ appointment.appointment_date|date:"l, F d, Y" }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Time</span>
          <span class="info-value">{{ appointment.appointment_time|time:"g:i A" }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Doctor</span>
          <span class="info-value">Dr. {{ appointment.doctor.user.get_full_name }} ({{ appointment.doctor.specialization
            }})</span>
        </div>
        <div class="info-row">
          <span class="info-label">Status</span>
          <span class="info-value">
            <span class="status-badge status-{{ appointment.status|lower }}">
              {{ appointment.status }}
            </span>
          </span>
        </div>
      </div>
    </div>

    <!-- Reason for Visit Card -->
    <div class="detail-card full-width">
      <div class="card-header">
        <h2>Reason for Visit</h2>
      </div>
      <div class="card-content">
        <p class="reason-text">{{ appointment.reason }}</p>
      </div>
    </div>

    <!-- Prescription Card -->
    {% if prescription %}
    <div class="detail-card full-width prescription-card">
      <div class="card-header">
        <h2>Prescription</h2>
      </div>
      <div class="card-content">
        <div class="info-row">
          <span class="info-label">Medication</span>
          <span class="info-value">{{ prescription.medication }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Instructions</span>
          <span class="info-value prescription-instructions">{{ prescription.instructions }}</span>
        </div>
      </div>
    </div>
    {% endif %}
  </div>

  <!-- Action Buttons -->
  <div class="action-section">
    <h3>Actions</h3>
    <div class="action-buttons-group">
      {% if appointment.status == "Pending" %}
      <form method="post" action="{% url 'clinic_app:doctor_approve_appointment' appointment.id %}" class="action-form">
        {% csrf_token %}
        <button type="submit" class="btn btn-success">
          Approve Appointment
        </button>
      </form>
      <form method="post" action="{% url 'clinic_app:doctor_cancel_appointment' appointment.id %}" class="action-form"
        onsubmit="return confirm('Are you sure you want to cancel this appointment?');">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">
          Cancel Appointment
        </button>
      </form>
      {% elif appointment.status == "Approved" %}
      <form method="post" action="{% url 'clinic_app:doctor_complete_appointment' appointment.id %}"
        class="action-form">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary">
          Mark as Completed
        </button>
      </form>
      {% if not prescription %}
      <a href="{% url 'clinic_app:doctor_add_prescription' appointment.id %}" class="btn btn-info">
        Add Prescription
      </a>
      {% endif %}
      {% elif appointment.status == "Completed" %}
      {% if not prescription %}
      <a href="{% url 'clinic_app:doctor_add_prescription' appointment.id %}" class="btn btn-info">
        Add Prescription
      </a>
      {% else %}
      <a href="{% url 'clinic_app:doctor_edit_prescription' prescription.id %}" class="btn btn-secondary">
        Edit Prescription
      </a>
      {% endif %}
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}